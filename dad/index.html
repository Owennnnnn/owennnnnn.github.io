<head>
    <title>Dad's Steem</title>
    <script src="https://cdn.jsdelivr.net/npm/steem/dist/steem.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var steemUsd
        var steemBtc = 0
        const Http = new XMLHttpRequest();
        const startUsd = 6433.77
        const startSteem = 14769.990
        const startBtc = 0.142
        const url='https://api.coingecko.com/api/v3/simple/price?ids=STEEM,Bitcoin&vs_currencies=btc,usd';
        Http.open("GET", url);
        Http.responseType = "json"
        Http.send();
        Http.onreadystatechange = (e) => {
            if (Http.readyState === 4) {
                steemBtc = Http.response['steem']['btc'];
                steemUsd = Http.response['steem']['usd'];
                btcUsd = Http.response['bitcoin']['usd'];
                console.log(steemBtc)
                console.log(steemUsd)
            }
        }
        function calc(accounts, state){
            if(steemBtc == 0){
                setTimeout(calc, 1000, accounts, state)
            }
            else {
                var vestingSteem = steem.formatter.vestingSteem(accounts[0], state.props);	
                vestingSteem = Math.round(vestingSteem * 1000) / 1000
                console.log(vestingSteem)
                document.getElementById('totalSteem').innerHTML = 'Total Steem: ' + vestingSteem + "<span style='color: teal;'> +" + Math.round((vestingSteem / startSteem - 1) * 10000) / 100 + '% (+' + Math.round((vestingSteem - startSteem) * 100) / 100 + " steem)</span>";
                document.getElementById('usdValue').innerHTML = 'Value in USD: $' + Math.round(vestingSteem * steemUsd * 100) / 100;
                document.getElementById('btcValue').innerHTML = 'Value in BTC: ' + Math.round(vestingSteem * steemBtc * 1000000) / 1000000 + ' BTC';
                percentStr = Math.round(((vestingSteem * steemUsd) / startUsd - 1) * 10000) / 100 + '%';
                if(vestingSteem * steemUsd > startUsd){
                    document.getElementById('profit').innerHTML = 'USD Value Profit: $' + Math.round(((vestingSteem * steemUsd) - startUsd) * 100) / 100 + ' ' + "<span style='color: teal;'>+" + percentStr + "</span>";
                }
                else
                document.getElementById('loss').innerHTML = 'USD Value Loss: $' + Math.round((startUsd - (vestingSteem * steemUsd)) * 100) / 100 + ' ' + "<span style='color: IndianRed;'>" + percentStr + "</span>";
                btcPercentStr = Math.round(((vestingSteem * steemBtc) / startBtc - 1) * 10000) / 100 + '%'
                if(vestingSteem * steemBtc > startBtc){
                    document.getElementById('btcProfit').innerHTML = 'BTC Value Profit: ' + Math.round(((vestingSteem * steemBtc) - startBtc) * 1000000) / 1000000 + ' BTC' + ' ' + "<span style='color: teal;'>+" + btcPercentStr + "</span>";
                }
                else{
                    document.getElementById('btcLoss').innerHTML = 'BTC Value Loss: ' + Math.round((startBtc - (vestingSteem * steemBtc)) * 1000000) / 1000000 + ' BTC' + ' ' + "<span style='color: IndianRed;'>" + btcPercentStr + "</span>";
                }
                if(Math.round(vestingSteem * steemUsd * 100) / 100 > Math.round(btcUsd * startBtc * 100) / 100){
                    document.getElementById('relativeProfit').innerHTML = 'Relative USD Profit: $' + (Math.round(((Math.round(vestingSteem * steemUsd * 100) / 100) - (Math.round(btcUsd * startBtc * 100) / 100)) * 100) / 100)
                }
                else{
                    document.getElementById('relativeLoss').innerHTML = 'Relative USD Loss: $' + (Math.round(((Math.round(btcUsd * startBtc * 100) / 100) - (Math.round(vestingSteem * steemUsd * 100) / 100)) * 100) / 100)
                }
            }
        }
        window.onload = function steemFunction(){
            steem.api.getAccounts(["zerothree"], function(e1, accounts) {
                if(e1){
                    console.log(e1);
                    steemFunction()
                }
                else
                steem.api.getState("/@zerothree", function (e2, state) {
                    if(e2){
                        steemFunction()
                    }
                    else
                        calc(accounts, state)
                    });
                });

        }
    </script>
</head>
<body style="background-color:343546">
    <center>
        <div>
		    <div id="totalSteem" style="color:rgb(22, 164, 230); font-size: 60;">loading...</div><br>
            <div id="usdValue" style="color:rgb(22, 164, 230); font-size: 60;"></div>
            <div id="btcValue" style="color:rgb(22, 164, 230); font-size: 60;"></div>
        </div>
        <div style="color:greenyellow; left: 50%; bottom: 0;">
        Initial investment: 14769.990 Steem<br></br>
        AKA 0.142 BTC or 6433.77 USD
        </div>
        <div id="profit" style="color:rgb(22, 230, 32); font-size: 60;"></div>
        <div id="loss" style="color:red; font-size: 60;"></div>
        <div id="btcProfit" style="color:rgb(22, 230, 32); font-size: 60;"></div>
        <div id="btcLoss" style="color:red; font-size: 60;"></div>
        <div id="relativeProfit" style="color:rgb(22, 230, 32); font-size: 60;"></div>
        <div id="relativeLoss" style="color:red; font-size: 60;"></div>
    </center>
</body>